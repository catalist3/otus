=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2023.07.18 11:44:14 =~=~=~=~=~=~=~=~=~=~=~=
login as: root
root@172.18.11.202's password: 
Last login: Tue Jul 18 04:34:00 2023 from 172.18.11.10
[root@localhost ~]# script /home/dimon/typescript
Script started, file is /home/dimon/typescript
[root@localhost ~]# [root@localhost ~]# [root@localhost ~]# fdisk -l | grep Disk
Disk /dev/sda: 34.4 GB, 34359738368 bytes, 67108864 sectors
Disklabel type: dos
Disk identifier: 0x000e11e8
Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Disk /dev/sdc: 10.7 GB, 10737418240 bytes, 20971520 sectors
Disk /dev/sdd: 10.7 GB, 10737418240 bytes, 20971520 sectors
Disk /dev/mapper/centos-root: 29.8 GB, 29842472960 bytes, 58286080 sectors
Disk /dev/mapper/centos-swap: 3435 MB, 3435134976 bytes, 6709248 sectors
[root@localhost ~]# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[root@localhost ~]# vgrcreate vg_root /dev/sdb
  Volume group "vg_root" successfully created
[root@localhost ~]# lvcreate -n lv_root -L +100%FREE /dev/vg_root
  Logical volume "lv_root" created.
[root@localhost ~]# mkfs.xfs /dev/vg_root/lv_root 
Discarding blocks...Done.
meta-data=/dev/vg_root/lv_root   isize=512    agcount=4, agsize=655104 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2620416, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@localhost ~]# mount /dev/vg_root/lv_root /mnt
[root@localhost ~]# pvdisplay
  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               centos
  PV Size               <31.00 GiB / not usable 3.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              7935
  Free PE               1
  Allocated PE          7934
  PV UUID               ma9vE8-tjLT-JKuH-ayT4-38RD-UJyR-6mDK0U
   
  --- Physical volume ---
  PV Name               /dev/sdb
  VG Name               vg_root
  PV Size               10.00 GiB / not usable 4.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              2559
  Free PE               0
  Allocated PE          2559
  PV UUID               oP30if-ulyp-KXPj-LBhM-vfj6-ffrx-gsBAFx
   
[root@localhost ~]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/centos/swap
  LV Name                swap
  VG Name                centos
  LV UUID                UNzKBX-aP4g-gwtt-jlhr-n2ly-8kO4-Gd5NDU
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 03:17:21 -0400
  LV Status              available
  # open                 2
  LV Size                <3.20 GiB
  Current LE             819
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/centos/root
  LV Name                root
  VG Name                centos
  LV UUID                6jpUC7-Qlyi-FPVc-NlEL-jyEr-c5c9-MNuINN
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 03:17:21 -0400
  LV Status              available
  # open                 1
  LV Size                27.79 GiB
  Current LE             7115
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
  --- Logical volume ---
  LV Path                /dev/vg_root/lv_root
  LV Name                lv_root
  VG Name                vg_root
  LV UUID                xTQsVs-Kmis-9xZ8-VO9h-lefa-Gico-u3E3pN
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 04:46:45 -0400
  LV Status              available
  # open                 1
  LV Size                <10.00 GiB
  Current LE             2559
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
[root@localhost ~]# xfsdump -J - /dev/centos/root | xfsrestore -J - /mnt
xfsdump: using file dump (drive_simple) strategy
xfsrestore: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0)
xfsrestore: version 3.1.7 (dump format 3.0)
xfsdump: level 0 dump of localhost.localdomain:/
xfsdump: dump date: Tue Jul 18 04:48:37 2023
xfsdump: session id: e9f08da8-64ef-458f-ba4a-6438d90d28b7
xfsdump: session label: ""
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 1559590976 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: localhost.localdomain
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/centos-root
xfsrestore: session time: Tue Jul 18 04:48:37 2023
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: c52338e3-487b-4c4e-b4c0-9a59e0b6d801
xfsrestore: session id: e9f08da8-64ef-458f-ba4a-6438d90d28b7
xfsrestore: media id: bd15dadb-836e-40fb-917a-0263364ce089
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 4873 directories and 34410 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 1527516064 bytes
xfsdump: dump size (non-dir files) : 1507370672 bytes
xfsdump: dump complete: 45 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 45 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@localhost ~]# mount --bind /proc/ /mnt/proc
[root@localhost ~]# mount --bind /proc/ /mnt/proc/
[root@localhost ~]# mount --bind /proc/ /mnt/proc/
[root@localhost ~]# mount --bind /sys/ /mnt/sys/
[root@localhost ~]# mount --bind /dev/ /mnt/dev/
[root@localhost ~]# mount --bind /run/ /mnt/run/
[root@localhost ~]# chroot /mnt/
[root@localhost /]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1160.92.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.92.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-1160.71.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.71.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-95f5dd2b9e864493ae4befe2a315b465
Found initrd image: /boot/initramfs-0-rescue-95f5dd2b9e864493ae4befe2a315b465.img
done
[root@localhost /]# cd /boot/

[root@localhost boot]# for i in `ls initramfs-*img`; do dracut -v `echo $i|sed "initramfs-//g; s/.img//g"` --force; done
# Правим файл grub.cfg
_________________________________________
[root@localhost boot]# vi grub2/grub.cfg 
[root@localhost boot]# cd /
[root@localhost /]# shutdown -r now
Running in chroot, ignoring request.
[root@localhost /]# exit
exit
[root@localhost ~]# shudtdown -r now
login as: root
root@172.18.11.202's password: 
Last login: Tue Jul 18 04:44:22 2023 from 172.18.11.10
[root@localhost ~]# [root@localhost ~]# lsblk
NAME              MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                 8:0    0   32G  0 disk 
├─sda1              8:1    0    1G  0 part /boot
└─sda2              8:2    0   31G  0 part 
  ├─centos-swap   253:1    0  3.2G  0 lvm  [SWAP]
  └─centos-root   253:2    0 27.8G  0 lvm  
sdb                 8:16   0   10G  0 disk 
└─vg_root-lv_root 253:0    0   10G  0 lvm  /
sdc                 8:32   0   10G  0 disk 
sdd                 8:48   0   10G  0 disk 
sr0                11:0    1  988M  0 rom  
[root@localhost ~]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/centos/swap
  LV Name                swap
  VG Name                centos
  LV UUID                UNzKBX-aP4g-gwtt-jlhr-n2ly-8kO4-Gd5NDU
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 03:17:21 -0400
  LV Status              available
  # open                 2
  LV Size                <3.20 GiB
  Current LE             819
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/centos/root
  LV Name                root
  VG Name                centos
  LV UUID                6jpUC7-Qlyi-FPVc-NlEL-jyEr-c5c9-MNuINN
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 03:17:21 -0400
  LV Status              available
  # open                 0
  LV Size                27.79 GiB
  Current LE             7115
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Logical volume ---
  LV Path                /dev/vg_root/lv_root
  LV Name                lv_root
  VG Name                vg_root
  LV UUID                xTQsVs-Kmis-9xZ8-VO9h-lefa-Gico-u3E3pN
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 04:46:45 -0400
  LV Status              available
  # open                 1
  LV Size                <10.00 GiB
  Current LE             2559
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
[root@localhost ~]# lvremove [root@localhost ~]# lvremove /dev/centos/root 
Do you really want to remove active logical volume centos/root? [y/n]: y
  Logical volume "root" successfully removed

[root@localhost ~]# lvcreate -n root -L 8G /centos/root -L 8G /dev/centos/[root@localhost ~]# pvremove /dev/centos/root [root@localhost ~]# pvcreate -n centos/root -L 8G /dev/centos/
WARNING: xfs signature detected on /dev/centos/root at offset 0. Wipe it? [y/n]: y
  Wiping xfs signature on /dev/centos/root.
  Logical volume "root" created.
[root@localhost ~]# mkfs.xfs /dev/centos/root 
Discarding blocks...Done.
meta-data=/dev/centos/root       isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@localhost ~]# mount /dev/centos/root /mnt
[root@localhost ~]# xfsdump -J - /dev/vg_root/lv_root | xfsrestore -J - /mnt
xfsdump: xfsrestore: using file dump (drive_simple) strategy
---------------------------------------------------------
xfsrestore: Restore Status: SUCCESS
[root@localhost ~]# mount --bind /proc/ /mnt/proc/
[root@localhost ~]# mount --bind /sys/ /mnt/sys/
[root@localhost ~]# mount --bind /dev/ /mnt/dev/
[root@localhost ~]# mount --bind /run/ /mnt/run/
[root@localhost ~]# chroot /mnt/
[root@localhost /]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1160.92.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.92.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-1160.71.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.71.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-95f5dd2b9e864493ae4befe2a315b465
Found initrd image: /boot/initramfs-0-rescue-95f5dd2b9e864493ae4befe2a315b465.img
done
[root@localhost /]# cd /boot/
[root@localhost boot]# for i in `ls initramfs-*img`; do dracut -v $i `echo %i|sed "s/initramfs-//g; s/.img//g"`; done
Kernel version 0 has no module directory /lib/modules/0
----------------------------------------------------------------------
*** Creating initramfs image file '/boot/initramfs-3.10.0-1160.92.1.el7.x86_64kdump.img' done ***
[root@localhost boot]# cd /
[root@localhost /]# pvcreate /dev/sdc /dev/sdd
  Physical volume "/dev/sdc" successfully created.
  Physical volume "/dev/sdd" successfully created.
[root@localhost /]# vgcreate vg_var /dev/sdc /dev/sdd
  Volume group "vg_var" successfully created
[root@localhost /]# lvcreate -L 950M -m1 -n lv_var vg_var
  Rounding up size to full physical extent 952.00 MiB
  Logical volume "lv_var" created.
[root@localhost /]# mkfs.ext4 /dev/vg_var/lv_var 
mke2fs 1.42.9 (28-Dec-2013)
Discarding device blocks:  done                            
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: 0/8  done                            
Writing inode tables: 0/8  done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: 0/8  done

[root@localhost /]# mount /dev/vg_var/lv_var /mnt
[root@localhost /]# cp -aR /var/* /mnt/
[root@localhost /]# mkdir /tmp/oldvar
[root@localhost /]# mv /var/* tmp/oldvar/
[root@localhost /]# umount /mnt
[root@localhost /]# mount dev/vg_var/lv_var  /var
[root@localhost /]# echo "`blkid | grep var: | awk /var ext4 defaults 0 0" >> /etc/fstab 
[root@localhost /]# shutdown -r now
Running in chroot, ignoring request.
[root@localhost /]# exit
exit
[root@localhost ~]# shutdown -r now

login as: root
root@172.18.11.202's password: 
Last login: Tue Jul 18 05:38:35 2023 from 172.18.11.10
[root@localhost ~]# lsblk
NAME              MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                 8:0    0   32G  0 disk 
├─sda1              8:1    0    1G  0 part /boot
└─sda2              8:2    0   31G  0 part 
  └─centos-swap   253:1    0  3.2G  0 lvm  [SWAP]
sdb                 8:16   0   10G  0 disk 
└─vg_root-lv_root 253:0    0   10G  0 lvm  /
sdc                 8:32   0   10G  0 disk 
sdd                 8:48   0   10G  0 disk 
sr0                11:0    1  988M  0 rom  
[root@localhost ~]# [root@localhost ~]# lvremove /dev/centos/root
  Failed to find logical volume "centos/root"
[root@localhost ~]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/centos/swap
  LV Name                swap
  VG Name                centos
  LV UUID                UNzKBX-aP4g-gwtt-jlhr-n2ly-8kO4-Gd5NDU
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 03:17:21 -0400
  LV Status              available
  # open                 2
  LV Size                <3.20 GiB
  Current LE             819
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/vg_root/lv_root
  LV Name                lv_root
  VG Name                vg_root
  LV UUID                xTQsVs-Kmis-9xZ8-VO9h-lefa-Gico-u3E3pN
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2023-07-18 04:46:45 -0400
  LV Status              available
  # open                 1
  LV Size                <10.00 GiB
  Current LE             2559
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
[root@localhost ~]# lvcreate -n centos/root /dev/centos/
WARNING: xfs signature detected on /dev/centos/root at offset 0. Wipe it? [y/n]: y
  Wiping xfs signature on /dev/centos/root.
  Logical volume "root" created.
[root@localhost ~]# mkfs.xfs /dev/centos/root 
Discarding blocks...Done.
meta-data=/dev/centos/root       isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@localhost ~]# mount /dev/centos/root /mnt
[root@localhost ~]# xfsdump -J - /dev/vg_root/lv_root | xfsrestore -J - /mnt
xfsrestore: using file dump (drive_simple) strategy
xfsdump: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0)
xfsdump: version 3.1.7 (dump format 3.0)
xfsdump: level 0 dump of localhost.localdomain:/
xfsdump: dump date: Tue Jul 18 05:53:05 2023
xfsdump: session id: 1337c660-d056-4b0a-8704-336567e34c07
xfsdump: session label: ""
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 1558219776 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: localhost.localdomain
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/vg_root-lv_root
xfsrestore: session time: Tue Jul 18 05:53:05 2023
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: c72bae8b-f4be-499b-9063-2be9b1f908be
xfsrestore: session id: 1337c660-d056-4b0a-8704-336567e34c07
xfsrestore: media id: e184349d-00d3-4aef-b815-bd0a4aeebcfe
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 4877 directories and 34413 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 1525943640 bytes
xfsdump: dump size (non-dir files) : 1505796200 bytes
xfsdump: dump complete: 52 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 52 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@localhost ~]# mount --bind /proc/ /mnt/proc/
[root@localhost ~]# mount --bind /proc/ /mnt/proc/
[root@localhost ~]# mount --bind /sys/ /mnt/sys/
[root@localhost ~]# mount --bind /dev/ /mnt/dev/
[root@localhost ~]# mount --bind /run/ /mnt/run/
[root@localhost ~]# chroor /mnt/ 
[root@localhost /]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1160.92.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.92.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-1160.71.1.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.71.1.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-95f5dd2b9e864493ae4befe2a315b465
Found initrd image: /boot/initramfs-0-rescue-95f5dd2b9e864493ae4befe2a315b465.img
done
[root@localhost /]# cd /boot
[root@localhost boot]# for i in `ls initramfs-*img`; do dracut -v $i `echo $i|sed "s/initramfs-//g; s/.img//g"` --force; done
Kernel version 0-rescue-95f5dd2b9e864493ae4befe2a315b465 has no module directory /lib/modules/0-rescue-95f5dd2b9e864493ae4befe2a315b465
----------------------------------------------------------------------
*** Creating initramfs image file '/boot/initramfs-3.10.0-1160.92.1.el7.x86_64kdump.img' done ***
[root@localhost boot]# cd /
[root@localhost /]# pvcreate /dev/sdc /dev/sdd
  Physical volume "/dev/sdc" successfully created.
  Physical volume "/dev/sdd" successfully created.
[root@localhost /]# lvcreate  vg_var /dev/sdc /dev/sdd
  Volume group "vg_var" successfully created
[root@localhost /]# lvcreate -L 950M -m1 -n lv_var vg_var
  Rounding up size to full physical extent 952.00 MiB
  Logical volume "lv_var" created.
[root@localhost /]# mkfs.ext4 /dev/vg_var//lv_var 
mke2fs 1.42.9 (28-Dec-2013)
Discarding device blocks:   4096/243712  done                            
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: 0/8   done                            
Writing inode tables: 0/8  done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: 0/8   done

[root@localhost /]# mount /dev/vg_var/lv_var  /mnt/
[root@localhost /]# cp -aR /var/* /mnt/
[root@localhost /]# mkdir /tmp/oldvar
[root@localhost /]# mv /var/* /tmp/oldvar/
[root@localhost /]# umount /mnt
[root@localhost /]# mount /dev/vg_var/lv_var  /var
[root@localhost /]# echo "`blkid | grep var: | awk /var ext4 defaults 0 0" >> /etc/fstab 
[root@localhost /]# exit
exit
[root@localhost ~]# shutdown -r now

login as: root
root@172.18.11.202's password: 
Last login: Tue Jul 18 06:58:22 2023
[root@localhost ~]# 
[root@localhost ~]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   32G  0 disk 
├─sda1                     8:1    0    1G  0 part /boot
└─sda2                     8:2    0   31G  0 part 
  ├─centos-root          253:0    0    8G  0 lvm  /
  └─centos-swap          253:1    0  3.2G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0   10G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sdd                        8:48   0   10G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sr0                       11:0    1  988M  0 rom  
[root@localhost ~]# lvremove /dev/vg_root/lv_root 
Do you really want to remove active logical volume vg_root/lv_root? [y/n]: y
  Logical volume "lv_root" successfully removed
[root@localhost ~]# vgremove /dev/vg_root
  Volume group "vg_root" successfully removed
root@localhost ~]# pvremove /dev/sdb
  Labels on physical volume "/dev/sdb" successfully wiped.
[root@localhost ~]# lvcreate -n vl_home -L 2G /dev/centos
  Logical volume "vl_home" created.
[root@localhost ~]# mkfs.xfs /dev/centos/vl_home 
Discarding blocks...Done.
meta-data=/dev/centos/vl_home    isize=512    agcount=4, agsize=131072 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=524288, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@localhost ~]# [root@localhost ~]# [root@localhost ~]# [root@localhost ~]# mount /dev/centos/vl_home  /mnt/
[root@localhost ~]# cp -aR /home/* /
[root@localhost ~]# cp -aR /home/* /mnt/
[root@localhost ~]# rm -rf /home/*
[root@localhost ~]# umount /mnt
[root@localhost ~]# mount /dev/centos/vl_home  /home/
[root@localhost ~]# blkid
/dev/mapper/vg_var-lv_var: UUID="0f679030-a430-4770-b37a-d36be70f2fb9" TYPE="ext4" 
/dev/sdc: UUID="u8O1gy-W7v5-ZJCp-X43S-Sa2V-jGl6-lqPyW3" TYPE="LVM2_member" 
/dev/sdd: UUID="IrXyqz-VZPo-uJmK-WNaj-l2N1-qxin-9cjeVW" TYPE="LVM2_member" 
/dev/sda1: UUID="7c1af5f7-7948-436e-8689-acb4616ba34c" TYPE="xfs" 
/dev/sda2: UUID="ma9vE8-tjLT-JKuH-ayT4-38RD-UJyR-6mDK0U" TYPE="LVM2_member" 
/dev/sr0: UUID="2022-07-26-15-08-22-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos-root: UUID="f76e18a1-fac6-47b9-bdac-712db255458b" TYPE="xfs" 
/dev/mapper/centos-swap: UUID="685b12dc-7a64-45b9-a42b-bf8008925e57" TYPE="swap" 
/dev/mapper/vg_var-lv_var_rimage_0: UUID="0f679030-a430-4770-b37a-d36be70f2fb9" TYPE="ext4" 
/dev/mapper/vg_var-lv_var_rimage_1: UUID="0f679030-a430-4770-b37a-d36be70f2fb9" TYPE="ext4" 
/dev/mapper/centos-vl_home: UUID="e9a6d5f2-a941-4ef7-9c0c-6273b0dd53e7" TYPE="xfs" 
[root@localhost ~]# echo "`blkid | grep home | awk /home xfs defaults 0 0" >> e/etc/fstab 
[root@localhost ~]# touch /home/file{1..20}
[root@localhost ~]# lvcreate -L 100MB -s -n home_snap /dev/centos/vl_home 
  Logical volume "home_snap" created.

total 0
drwxr-xr-x.  3 root  root  290 Jul 18 07:08 [0m[01;34m.[0m
drwxr-xr-x. 17 root  root  224 Jul 18 05:53 [01;34m..[0m
drwx------.  2 dimon dimon  80 Jul 18 04:44 [01;34mdimon[0m
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file1
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file10
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file11
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file12
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file13
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file14
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file15
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file16
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file17
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file18
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file19
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file2
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file20
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file3
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file4
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file5
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file6
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file7
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file8
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file9
[root@localhost ~]# rm -f /home/file{1..20}
[root@localhost ~]# rm -f /home/file{11..20}[root@localhost ~]# ls -la /home/
total 0
drwxr-xr-x.  3 root  root  150 Jul 18 07:10 [0m[01;34m.[0m
drwxr-xr-x. 17 root  root  224 Jul 18 05:53 [01;34m..[0m
drwx------.  2 dimon dimon  80 Jul 18 04:44 [01;34mdimon[0m
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file1
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file10
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file2
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file3
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file4
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file5
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file6
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file7
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file8
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file9
[root@localhost ~]# umount /home/
[root@localhost ~]# lvconvert  --merge /dev/centos/home_snap 
  Merging of volume centos/home_snap started.
  centos/vl_home: Merged: 100.00%
[root@localhost ~]# mount /home
[root@localhost ~]# mlvconvert  --merge /dev/centos/home_snap [root@localhost ~]# ls -la /home/
total 0
drwxr-xr-x.  3 root  root  290 Jul 18 07:08 [0m[01;34m.[0m
drwxr-xr-x. 17 root  root  224 Jul 18 05:53 [01;34m..[0m
drwx------.  2 dimon dimon  80 Jul 18 04:44 [01;34mdimon[0m
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file1
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file10
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file11
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file12
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file13
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file14
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file15
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file16
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file17
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file18
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file19
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file2
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file20
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file3
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file4
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file5
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file6
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file7
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file8
-rw-r--r--.  1 root  root    0 Jul 18 07:08 file9
[root@localhost ~]# 